{
 "name": "Sent Sales Invoices",
 "docstatus": 0,
 "report_name": "Sent Sales Invoices",
 "ref_doctype": "Sales Invoice",
 "reference_report": null,
 "is_standard": "Yes",
 "module": "Accounts",
 "report_type": "Script Report",
 "letter_head": "SurgiShop",
 "add_total_row": 0,
 "disabled": 0,
 "prepared_report": 0,
 "add_translate_data": 0,
 "timeout": 0,
 "query": null,
 "report_script": "\"\"\"\r\nReport: Auto-Sent Sales Invoices\r\nType: Script Report\r\n\r\nThis report shows all sales invoices that were automatically sent via email,\r\nwith filters for date range and sending status.\r\n\"\"\"\r\n\r\ndef execute(filters=None):\r\n    columns = get_columns()\r\n    data = get_data(filters)\r\n    return columns, data\r\n\r\ndef get_columns():\r\n    \"\"\"Define the columns for the report\"\"\"\r\n    return [\r\n        {\r\n            \"fieldname\": \"name\",\r\n            \"label\": \"Invoice Number\",\r\n            \"fieldtype\": \"Link\",\r\n            \"options\": \"Sales Invoice\",\r\n            \"width\": 150\r\n        },\r\n        {\r\n            \"fieldname\": \"posting_date\",\r\n            \"label\": \"Invoice Date\",\r\n            \"fieldtype\": \"Date\",\r\n            \"width\": 100\r\n        },\r\n        {\r\n            \"fieldname\": \"customer\",\r\n            \"label\": \"Customer\",\r\n            \"fieldtype\": \"Link\",\r\n            \"options\": \"Customer\",\r\n            \"width\": 180\r\n        },\r\n        {\r\n            \"fieldname\": \"customer_name\",\r\n            \"label\": \"Customer Name\",\r\n            \"fieldtype\": \"Data\",\r\n            \"width\": 180\r\n        },\r\n        {\r\n            \"fieldname\": \"grand_total\",\r\n            \"label\": \"Amount\",\r\n            \"fieldtype\": \"Currency\",\r\n            \"width\": 120\r\n        },\r\n        {\r\n            \"fieldname\": \"custom_auto_send_status\",\r\n            \"label\": \"Send Status\",\r\n            \"fieldtype\": \"Data\",\r\n            \"width\": 100\r\n        },\r\n        {\r\n            \"fieldname\": \"custom_scheduled_send_time\",\r\n            \"label\": \"Scheduled Send Time\",\r\n            \"fieldtype\": \"Datetime\",\r\n            \"width\": 160\r\n        },\r\n        {\r\n            \"fieldname\": \"custom_actual_send_time\",\r\n            \"label\": \"Actual Send Time\",\r\n            \"fieldtype\": \"Datetime\",\r\n            \"width\": 160\r\n        },\r\n        {\r\n            \"fieldname\": \"contact_email\",\r\n            \"label\": \"Email Sent To\",\r\n            \"fieldtype\": \"Data\",\r\n            \"width\": 180\r\n        }\r\n    ]\r\n\r\ndef get_data(filters):\r\n    \"\"\"Fetch the data based on filters\"\"\"\r\n    \r\n    conditions = [\"docstatus = 1\"]  # Only submitted invoices\r\n    \r\n    # Add status filter\r\n    if filters.get(\"status\"):\r\n        conditions.append(\"custom_auto_send_status = '\" + filters.get(\"status\") + \"'\")\r\n    else:\r\n        # By default, show only Sent and Failed (not blank/Scheduled)\r\n        conditions.append(\"custom_auto_send_status IN ('Sent', 'Failed')\")\r\n    \r\n    # Add date range filters\r\n    if filters.get(\"from_date\"):\r\n        conditions.append(\"custom_actual_send_time >= '\" + str(filters.get(\"from_date\")) + \"'\")\r\n    \r\n    if filters.get(\"to_date\"):\r\n        conditions.append(\"custom_actual_send_time <= '\" + str(filters.get(\"to_date\")) + \" 23:59:59'\")\r\n    \r\n    # Build the WHERE clause\r\n    where_clause = \" AND \".join(conditions)\r\n    \r\n    # Execute the query\r\n    data = frappe.db.sql(\"\"\"\r\n        SELECT \r\n            name,\r\n            posting_date,\r\n            customer,\r\n            customer_name,\r\n            grand_total,\r\n            custom_auto_send_status,\r\n            custom_scheduled_send_time,\r\n            custom_actual_send_time,\r\n            contact_email\r\n        FROM `tabSales Invoice`\r\n        WHERE {where_clause}\r\n        ORDER BY custom_actual_send_time DESC\r\n    \"\"\".replace(\"{where_clause}\", where_clause), as_dict=1)\r\n    \r\n    return data",
 "javascript": null,
 "json": null,
 "doctype": "Report",
 "filters": [
  {
   "name": "fl7jclqrke",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-15 13:36:59.545029",
   "modified": "2025-12-16 13:24:08.947822",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 1,
   "label": "From Date",
   "fieldtype": "Date",
   "fieldname": "from_date",
   "mandatory": 0,
   "wildcard_filter": 0,
   "options": null,
   "default": null,
   "parent": "Sent Sales Invoices",
   "parentfield": "filters",
   "parenttype": "Report",
   "doctype": "Report Filter"
  },
  {
   "name": "fl7j7pmnt9",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-15 13:36:59.545029",
   "modified": "2025-12-16 13:24:08.947822",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 2,
   "label": "To Date",
   "fieldtype": "Date",
   "fieldname": "to_date",
   "mandatory": 0,
   "wildcard_filter": 0,
   "options": null,
   "default": null,
   "parent": "Sent Sales Invoices",
   "parentfield": "filters",
   "parenttype": "Report",
   "doctype": "Report Filter"
  },
  {
   "name": "fl7j6n0bk3",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-15 13:36:59.545029",
   "modified": "2025-12-16 13:24:08.947822",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 3,
   "label": "Status",
   "fieldtype": "Select",
   "fieldname": "status",
   "mandatory": 0,
   "wildcard_filter": 0,
   "options": "\nScheduled\nSent\nFailed",
   "default": null,
   "parent": "Sent Sales Invoices",
   "parentfield": "filters",
   "parenttype": "Report",
   "doctype": "Report Filter"
  }
 ],
 "roles": [
  {
   "name": "fl7ja0436f",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-15 13:36:59.545029",
   "modified": "2025-12-16 13:24:08.947822",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 1,
   "role": "Accounts User",
   "parent": "Sent Sales Invoices",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "fl7jhg5l36",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-15 13:36:59.545029",
   "modified": "2025-12-16 13:24:08.947822",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 2,
   "role": "Accounts Manager",
   "parent": "Sent Sales Invoices",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "fl7jpfsne2",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-15 13:36:59.545029",
   "modified": "2025-12-16 13:24:08.947822",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 3,
   "role": "Sales User",
   "parent": "Sent Sales Invoices",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "fl7jvegl6q",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-15 13:36:59.545029",
   "modified": "2025-12-16 13:24:08.947822",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 4,
   "role": "System Manager",
   "parent": "Sent Sales Invoices",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  }
 ],
 "columns": []
}