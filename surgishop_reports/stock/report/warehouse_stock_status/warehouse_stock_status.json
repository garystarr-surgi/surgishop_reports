{
 "name": "Warehouse Stock Status",
 "docstatus": 0,
 "report_name": "Warehouse Stock Status",
 "ref_doctype": "Item",
 "reference_report": null,
 "is_standard": "Yes",
 "module": "Stock",
 "report_type": "Query Report",
 "letter_head": "SurgiShop",
 "add_total_row": 0,
 "disabled": 0,
 "prepared_report": 0,
 "add_translate_data": 0,
 "timeout": 0,
 "query": "SELECT\r\n  i.brand AS \"Brand:Link/Brand:120\",\r\n  i.item_code AS \"Item Code:Link/Item:150\",\r\n  -- NEW: Consolidate all location fields\r\n  CONCAT_WS(', ', \r\n    NULLIF(i.custom_item_location, ''),\r\n    NULLIF(i.custom_item_location_2, ''),\r\n    NULLIF(i.custom_item_location_3, ''),\r\n    NULLIF(i.custom_item_location_4, ''),\r\n    NULLIF(i.custom_item_location_5, ''),\r\n    NULLIF(i.custom_item_location_6, '')\r\n  ) AS \"Location:Data:200\",\r\n  (\r\n    -- Calculate Available using the now-filtered 'On Shelves' (b)\r\n    COALESCE(b.total_on_shelves, 0)\r\n    - COALESCE(oq.total_in_open_quotations, 0)\r\n    - COALESCE(soi.total_in_sales_orders, 0)\r\n  ) AS \"Available:Int:150\",\r\n  -- 'On Shelves' now only pulls from 'Stores - SURGI'\r\n  COALESCE(b.total_on_shelves, 0) AS \"On Shelves:Int:100\", \r\n  COALESCE(oq.total_in_open_quotations, 0) AS \"In Open Quotations:Int:120\",\r\n  COALESCE(soi.total_in_sales_orders, 0) AS \"In Sales Orders:Int:120\",\r\n  \r\n  -- Blemish Quantity\r\n  COALESCE(bl.total_in_blemish, 0) AS \"Blemish:Int:100\",\r\n  \r\n  -- Temperature Critical Checkmark\r\n  IF(i.custom_temperature_critical, '\u2713', '') AS \"Temperature:Data:100\"\r\nFROM `tabItem` i\r\n-- On Shelves (Bin) - Alias 'b' - *** CORRECTED TO 'Stores - SURGI' ONLY ***\r\nLEFT JOIN (\r\n  SELECT item_code, SUM(actual_qty) AS total_on_shelves\r\n  FROM `tabBin`\r\n  WHERE warehouse = 'Stores - SURGI' \r\n  GROUP BY item_code\r\n) b ON b.item_code = i.item_code\r\n-- Open Quotations - Alias 'oq'\r\nLEFT JOIN (\r\n  SELECT qi.item_code,\r\n         SUM(qi.stock_qty) AS total_in_open_quotations\r\n  FROM `tabQuotation Item` qi\r\n  INNER JOIN `tabQuotation` q\r\n    ON q.name = qi.parent\r\n    AND q.docstatus = 1\r\n    AND q.status = 'Open'\r\n    AND (q.valid_till IS NULL OR q.valid_till >= CURDATE())\r\n  GROUP BY qi.item_code\r\n) oq ON oq.item_code = i.item_code\r\n-- Sales Orders - Alias 'soi'\r\nLEFT JOIN (\r\n  SELECT soi.item_code,\r\n         SUM(soi.stock_qty) AS total_in_sales_orders\r\n  FROM `tabSales Order Item` soi\r\n  INNER JOIN `tabSales Order` so\r\n    ON so.name = soi.parent\r\n    AND so.docstatus = 1\r\n    AND so.status NOT IN ('Closed', 'Completed')\r\n  GROUP BY soi.item_code\r\n) soi ON soi.item_code = i.item_code\r\n-- Blemish Quantity - Alias 'bl'\r\nLEFT JOIN (\r\n  SELECT item_code, SUM(actual_qty) AS total_in_blemish\r\n  FROM `tabBin`\r\n  WHERE warehouse = 'Blemish - SURGI' \r\n  GROUP BY item_code\r\n) bl ON bl.item_code = i.item_code\r\nWHERE IFNULL(i.disabled, 0) = 0\r\n  AND (%(item_code)s = '' OR %(item_code)s IS NULL OR i.item_code = %(item_code)s)\r\n  AND (\r\n    -- The WHERE clause ensures we only show items with stock or open orders in any tracked warehouse\r\n    COALESCE(b.total_on_shelves, 0) <> 0\r\n    OR COALESCE(oq.total_in_open_quotations, 0) <> 0\r\n    OR COALESCE(soi.total_in_sales_orders, 0) <> 0\r\n    OR COALESCE(bl.total_in_blemish, 0) <> 0 \r\n  )\r\nORDER BY i.item_code;",
 "report_script": "frappe.query_reports[\"Stock Status\"] = {\r\n  formatter(value, row, column, data, default_formatter) {\r\n    const colKey = (column.fieldname || \"\").toLowerCase();\r\n    \r\n    value = default_formatter(value, row, column, data);\r\n    \r\n    // --- Center all columns except first two (Brand + Item Code) ---\r\n    const colIdx =\r\n      typeof column.colIndex === \"number\"\r\n        ? column.colIndex\r\n        : (column.id && column.id.match(/col-(\\d+)/))\r\n        ? parseInt(column.id.match(/col-(\\d+)/)[1])\r\n        : null;\r\n    const isFirstTwo =\r\n      colIdx !== null\r\n        ? colIdx <= 1\r\n        : [\"brand\", \"item_code\"].includes(colKey);\r\n    if (!isFirstTwo) {\r\n      return `<div style=\"text-align:center\">${value}</div>`;\r\n    }\r\n    return value; // leave first two columns default-aligned\r\n  }\r\n};",
 "javascript": null,
 "json": null,
 "doctype": "Report",
 "filters": [
  {
   "name": "522j6o2d4c",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 1,
   "label": "Item",
   "fieldtype": "Link",
   "fieldname": "item_code",
   "mandatory": 0,
   "wildcard_filter": 0,
   "options": "Item",
   "default": "1951B",
   "parent": "Warehouse Stock Status",
   "parentfield": "filters",
   "parenttype": "Report",
   "doctype": "Report Filter"
  }
 ],
 "roles": [
  {
   "name": "522joe4nln",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 1,
   "role": "Desk User",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522j6433ka",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 2,
   "role": "Stock Manager",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522jc43lu1",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 3,
   "role": "Item Manager",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522j9i8lv2",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 4,
   "role": "Manufacturing User",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522j7opbk0",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 5,
   "role": "Purchase User",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522jt11i8o",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 6,
   "role": "Accounts User",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522jo3n6tu",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 7,
   "role": "Stock User",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522jau42fb",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 8,
   "role": "Maintenance User",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522jabcnuv",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 9,
   "role": "Sales User",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "522jf5g2cn",
   "owner": "gary.starr@surgishop.com",
   "creation": "2025-12-18 12:04:08.291975",
   "modified": "2025-12-18 12:04:26.762210",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 10,
   "role": "System Manager",
   "parent": "Warehouse Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  }
 ],
 "columns": []
}