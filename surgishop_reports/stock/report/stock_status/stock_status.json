{
 "name": "Stock Status",
 "docstatus": 0,
 "report_name": "Stock Status",
 "ref_doctype": "Item",
 "reference_report": null,
 "is_standard": "Yes",
 "module": "Stock",
 "report_type": "Query Report",
 "letter_head": "SurgiShop",
 "add_total_row": 0,
 "disabled": 0,
 "prepared_report": 0,
 "add_translate_data": 0,
 "timeout": 0,
 "query": "SELECT\r\n  i.brand AS \"Brand:Link/Brand:120\",\r\n  i.item_code AS \"Item Code:Link/Item:150\",\r\n\r\n  (\r\n    -- Calculate Available using the now-filtered 'On Shelves' (b)\r\n    COALESCE(b.total_on_shelves, 0)\r\n    - COALESCE(oq.total_in_open_quotations, 0)\r\n    - COALESCE(soi.total_in_sales_orders, 0)\r\n  ) AS \"Available:Int:150\",\r\n  -- 'On Shelves' now only pulls from 'Stores - SURGI'\r\n  COALESCE(b.total_on_shelves, 0) AS \"On Shelves:Int:100\", \r\n  COALESCE(oq.total_in_open_quotations, 0) AS \"In Open Quotations:Int:120\",\r\n  COALESCE(soi.total_in_sales_orders, 0) AS \"In Sales Orders:Int:120\",\r\n\r\n  NULLIF(i.custom_competitive, 0) AS \"Competitive:Currency:120\",\r\n  NULLIF(i.custom_approval_only, 0) AS \"Approval Only:Currency:120\",\r\n  \r\n  -- Blemish Quantity\r\n  COALESCE(bl.total_in_blemish, 0) AS \"Blemish:Int:100\",\r\n  \r\n  -- Temperature Critical Checkmark\r\n  IF(i.custom_temperature_critical, '\u2713', '') AS \"Temperature:Data:100\"\r\nFROM `tabItem` i\r\n\r\n-- On Shelves (Bin) - Alias 'b' - *** CORRECTED TO 'Stores - SURGI' ONLY ***\r\nLEFT JOIN (\r\n  SELECT item_code, SUM(actual_qty) AS total_on_shelves\r\n  FROM `tabBin`\r\n  WHERE warehouse = 'Stores - SURGI' \r\n  GROUP BY item_code\r\n) b ON b.item_code = i.item_code\r\n\r\n-- Open Quotations - Alias 'oq'\r\nLEFT JOIN (\r\n  SELECT qi.item_code,\r\n         SUM(qi.stock_qty) AS total_in_open_quotations\r\n  FROM `tabQuotation Item` qi\r\n  INNER JOIN `tabQuotation` q\r\n    ON q.name = qi.parent\r\n    AND q.docstatus = 1\r\n    AND q.status = 'Open'\r\n    AND (q.valid_till IS NULL OR q.valid_till >= CURDATE())\r\n  GROUP BY qi.item_code\r\n) oq ON oq.item_code = i.item_code\r\n\r\n-- Sales Orders - Alias 'soi'\r\nLEFT JOIN (\r\n  SELECT soi.item_code,\r\n         SUM(soi.stock_qty) AS total_in_sales_orders\r\n  FROM `tabSales Order Item` soi\r\n  INNER JOIN `tabSales Order` so\r\n    ON so.name = soi.parent\r\n    AND so.docstatus = 1\r\n    AND so.status NOT IN ('Closed', 'Completed')\r\n  GROUP BY soi.item_code\r\n) soi ON soi.item_code = i.item_code\r\n\r\n-- Blemish Quantity - Alias 'bl'\r\nLEFT JOIN (\r\n  SELECT item_code, SUM(actual_qty) AS total_in_blemish\r\n  FROM `tabBin`\r\n  WHERE warehouse = 'Blemish - SURGI' \r\n  GROUP BY item_code\r\n) bl ON bl.item_code = i.item_code\r\n\r\nWHERE IFNULL(i.disabled, 0) = 0\r\n  AND (\r\n    -- The WHERE clause ensures we only show items with stock or open orders in any tracked warehouse\r\n    COALESCE(b.total_on_shelves, 0) <> 0\r\n    OR COALESCE(oq.total_in_open_quotations, 0) <> 0\r\n    OR COALESCE(soi.total_in_sales_orders, 0) <> 0\r\n    OR COALESCE(bl.total_in_blemish, 0) <> 0 \r\n  )\r\nORDER BY i.item_code;",
 "report_script": "frappe.query_reports[\"Stock Status\"] = {\n  formatter(value, row, column, data, default_formatter) {\n    const colKey = (column.fieldname || \"\").toLowerCase();\n\n    // --- Handle currency columns (blank if 0/null) ---\n    if ([\"competitive\", \"approval_only\"].includes(colKey)) {\n      const raw = data?.[column.fieldname] ?? value;\n      const n = Number(raw);\n      if (raw === null || raw === undefined || raw === \"\" || isNaN(n) || n === 0) {\n        value = \"\";\n      } else {\n        value = default_formatter(raw, row, column, data);\n      }\n    } else {\n      value = default_formatter(value, row, column, data);\n    }\n\n    // --- Center all columns except first two (Brand + Item Code) ---\n    const colIdx =\n      typeof column.colIndex === \"number\"\n        ? column.colIndex\n        : (column.id && column.id.match(/col-(\\d+)/))\n        ? parseInt(column.id.match(/col-(\\d+)/)[1])\n        : null;\n\n    const isFirstTwo =\n      colIdx !== null\n        ? colIdx <= 1\n        : [\"brand\", \"item_code\"].includes(colKey);\n\n    if (!isFirstTwo) {\n      return `<div style=\"text-align:center\">${value}</div>`;\n    }\n\n    return value; // leave first two columns default-aligned\n  }\n};\n",
 "javascript": null,
 "json": null,
 "doctype": "Report",
 "filters": [],
 "roles": [
  {
   "name": "7l28p11v8t",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 1,
   "role": "Item Manager",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l28k1397g",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 2,
   "role": "Stock Manager",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l286tt92f",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 3,
   "role": "Stock User",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l28cvlf59",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 4,
   "role": "Sales User",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l284cd9mt",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 5,
   "role": "Purchase User",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l28vau2hr",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 6,
   "role": "Maintenance User",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l284d24io",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 7,
   "role": "Accounts User",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l289c2hna",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 8,
   "role": "Manufacturing User",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  },
  {
   "name": "7l2887gdvg",
   "owner": "Arthur.Borges@surgishop.com",
   "creation": "2025-10-17 09:45:17.594717",
   "modified": "2025-11-25 10:55:00.384153",
   "modified_by": "gary.starr@surgishop.com",
   "docstatus": 0,
   "idx": 9,
   "role": "Desk User",
   "parent": "Stock Status",
   "parentfield": "roles",
   "parenttype": "Report",
   "doctype": "Has Role"
  }
 ],
 "columns": []
}